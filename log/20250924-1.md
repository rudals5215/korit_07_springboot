ì¢‹ìŠµë‹ˆë‹¤ ğŸ‘
ì§€ê¸ˆê¹Œì§€ ë‹¤ë£¬ **OpenAPI â†’ Bean ê°œë… â†’ Spring Security(DB ì—°ë™) â†’ JWT ê¸°ì´ˆ â†’ Postman ì¸ì¦ ì‹¤ìŠµ** íë¦„ì„,
ì €ë²ˆì— ë³´ì—¬ì£¼ì‹  *Car Database ê¸°ìˆ  ë¸”ë¡œê·¸ ê¸€* ìŠ¤íƒ€ì¼ë¡œ ì •ë¦¬í•´ë“œë¦´ê²Œìš”.

---

# Spring Bootì—ì„œ ë°±ì—”ë“œ ë³´í˜¸í•˜ê¸° (OpenAPI + Spring Security + JWT)

## 1. REST API ë¬¸ì„œí™” (OpenAPI 3)

### 1) ì˜ì¡´ì„± ì¶”ê°€

```gradle
implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.0.2'
```

### 2) ì„¤ì • í´ë˜ìŠ¤

```java
@Configuration
public class OpenApiConfig {
    
  @Bean
  public OpenAPI carDatabaseOpenApi(){
    return new OpenAPI()
      .info(new Info()
              .title("Car REST API")
              .description("My car Stock")
              .version("1.0"));
  }
}
```

### 3) application.properties

```properties
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.api-docs.path=/api-docs
```

â†’ ì ‘ì† : `http://localhost:8080/swagger-ui.html`
ìë™ìœ¼ë¡œ REST ì—”ë“œí¬ì¸íŠ¸ë¥¼ í™•ì¸ ê°€ëŠ¥.

---

## 2. Beanê³¼ @Bean ê°œë…

* **Bean** : ìŠ¤í”„ë§ IoC ì»¨í…Œì´ë„ˆê°€ ê´€ë¦¬í•˜ëŠ” ê°ì²´ (ì‹±ê¸€í†¤)
* **@Bean** : ë©”ì„œë“œ ë°˜í™˜ ê°ì²´ë¥¼ ì»¨í…Œì´ë„ˆì— ë“±ë¡

### @Bean ì‚¬ìš© ì „

```java
public class MyController {
  private MyService myService = new MyService();
}
```

â†’ ê°•í•œ ê²°í•©, í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€.

### @Bean ì‚¬ìš© í›„

```java
@Configuration
public class AppConfig {
  @Bean
  public MyService myService() {
    return new MyService();
  }
}
```

```java
@Controller
public class MyController {
  private final MyService myService;
  public MyController(MyService myService) {
    this.myService = myService;
  }
}
```

â†’ IoC ì»¨í…Œì´ë„ˆê°€ ê°ì²´ë¥¼ ìƒì„± & ì£¼ì… â†’ ê²°í•©ë„ â†“, í…ŒìŠ¤íŠ¸ â†‘.

---

## 3. Spring Security ê¸°ë³¸ ë„ì…

### 1) ì˜ì¡´ì„± ì¶”ê°€

```gradle
implementation 'org.springframework.boot:spring-boot-starter-security'
```

### 2) ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©ì ì˜ˆì‹œ

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public InMemoryUserDetailsManager userDetailsService(){
        UserDetails user = User.builder()
                .username("user")
                .password(passwordEncoder().encode("password"))
                .roles("USER")
                .build();
        return new InMemoryUserDetailsManager(user);
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

â†’ ì‹¤í–‰ ì‹œ `/login` ìë™ ì œê³µ, Basic Authë¡œ ì¸ì¦ í™•ì¸ ê°€ëŠ¥.

---

## 4. DB ì‚¬ìš©ì ì—°ë™í•˜ê¸°

### 1) AppUser ì—”í‹°í‹°

```java
@Entity
@NoArgsConstructor(force = true)
@RequiredArgsConstructor
@Getter
@Setter
public class AppUser {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;

    @Column(nullable = false, unique = true)
    private final String username;

    @Column(nullable = false)
    private final String password;

    @Column(nullable = false)
    private final String role;
}
```

### 2) AppUserRepository

```java
@RepositoryRestResource(exported = false)
public interface AppUserRepository extends JpaRepository<AppUser, Long> {
    Optional<AppUser> findByUsername(String username);
}
```

â†’ `exported = false`ë¡œ ìë™ REST ë…¸ì¶œ ì°¨ë‹¨.

### 3) UserDetailsService êµ¬í˜„

```java
@Service
public class UserDetailsServiceImpl implements UserDetailsService {
    private final AppUserRepository userRepository;

    public UserDetailsServiceImpl(AppUserRepository userRepository) {
        this.userRepository = userRepository;
    }

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        Optional<AppUser> user = userRepository.findByUsername(username);

        if (user.isPresent()) {
            AppUser currentUser = user.get();
            return User.withUsername(username)
                       .password(currentUser.getPassword())
                       .roles(currentUser.getRole())
                       .build();
        } else {
            throw new UsernameNotFoundException("User not found.");
        }
    }
}
```

### 4) SecurityConfig (DB ì—°ë™)

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    private final UserDetailsServiceImpl userDetailsService;

    public SecurityConfig(UserDetailsServiceImpl userDetailsService) {
        this.userDetailsService = userDetailsService;
    }

    public void configGlobal(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService)
            .passwordEncoder(new BCryptPasswordEncoder());
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

â†’ DB ì‚¬ìš©ì ì¸ì¦ì´ ê°€ëŠ¥í•´ì§.

---

## 5. Postman ì¸ì¦ í…ŒìŠ¤íŠ¸

1. `GET http://localhost:8080/api/cars` ìš”ì²­

   * ì¸ì¦ ì—†ìŒ â†’ `401 Unauthorized`
2. Basic Auth ì„ íƒ â†’ DB ì‚¬ìš©ì ê³„ì • ì…ë ¥

   * ì¸ì¦ ì„±ê³µ â†’ `200 OK`

---

## 6. JWT ë„ì… ì¤€ë¹„

### 1) ì˜ì¡´ì„± ì¶”ê°€

```gradle
implementation 'io.jsonwebtoken:jjwt-api:0.11.5'
runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.11.5'
runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.11.5'
```

### 2) JwtService

```java
@Component
public class JwtService {
    static final long EXPIRATIONTIME = 86400000; // 1ì¼
    static final String PREFIX = "Bearer";
    static final Key key = Keys.secretKeyFor(SignatureAlgorithm.HS256);

    public String getToken(String username) {
        return Jwts.builder()
                   .setSubject(username)
                   .setExpiration(new Date(System.currentTimeMillis() + EXPIRATIONTIME))
                   .signWith(key)
                   .compact();
    }

    public String getAuthUser(HttpServletRequest request){
        String token = request.getHeader(HttpHeaders.AUTHORIZATION);
        if (token != null) {
            return Jwts.parserBuilder()
                       .setSigningKey(key)
                       .build()
                       .parseClaimsJws(token.replace(PREFIX, ""))
                       .getBody()
                       .getSubject();
        }
        return null;
    }
}
```

â†’ í† í° ë°œê¸‰(`getToken`) + ì‚¬ìš©ì ê²€ì¦(`getAuthUser`) ì§€ì›.

---

## 7. ë§ˆë¬´ë¦¬

ì´ë²ˆ í•™ìŠµ íë¦„ ì •ë¦¬:

1. OpenAPI 3ë¡œ REST API ë¬¸ì„œí™”
2. Bean / @Bean ê°œë… ì •ë¦¬
3. Spring Security ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©ì í…ŒìŠ¤íŠ¸
4. DB ì‚¬ìš©ì ì—°ë™ ë° Repository ë³´ì•ˆ ì²˜ë¦¬
5. Postmanìœ¼ë¡œ ì¸ì¦ í…ŒìŠ¤íŠ¸
6. JWT ë„ì… ì¤€ë¹„ (í† í° ë°œê¸‰ & ê²€ì¦ ë¡œì§)

ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ” **JWT ë¡œê·¸ì¸ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ â†’ í•„í„° ì ìš© â†’ Role ê¸°ë°˜ ì¸ê°€**ê¹Œì§€ í™•ì¥í•  ì˜ˆì •ì…ë‹ˆë‹¤. ğŸš€

---

ğŸ‘‰ ì´ë ‡ê²Œ í•˜ë©´ ë²¨ë¡œê·¸/ê¹ƒí—ˆë¸Œ ë¸”ë¡œê·¸ì— ê·¸ëŒ€ë¡œ ì˜¬ë ¤ë„ **íë¦„ + ì½”ë“œ + ì„¤ëª…**ì´ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§€ëŠ” ê¸€ì´ ë©ë‹ˆë‹¤.

ì›í•˜ì‹œë©´ ì œê°€ ì´ ê¸€ì„ **1í¸(REST + ë¬¸ì„œí™”)**, **2í¸(Security + JWT)** ì‹œë¦¬ì¦ˆë¡œ ë‚˜ëˆ ë“œë¦´ê¹Œìš”?
