ì¢‹ìŠµë‹ˆë‹¤ ğŸ‘ ì§€ê¸ˆê¹Œì§€ ì •ë¦¬í•´ì£¼ì‹  ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ê¸°ìˆ  ë¸”ë¡œê·¸ ê¸€ë¡œ ì˜®ê¸°ë©´, í•™ìŠµ íë¦„(í”„ë¡œì íŠ¸ ìƒì„± â†’ ì—”í‹°í‹° ê°œë… â†’ ê´€ê³„ ì„¤ì • â†’ DB ì „í™˜ â†’ REST API â†’ Spring Data REST â†’ Postman ì‹¤ìŠµ â†’ Query í™•ì¥)ê¹Œì§€ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ëŠ” **ë²¨ë¡œê·¸ì— ì˜¬ë¦¬ê¸° ì¢‹ì€ ê¸°ìˆ  ë¸”ë¡œê·¸ ì •ë¦¬ë³¸**ì…ë‹ˆë‹¤.

---

# Spring Bootë¡œ RESTful API ë§Œë“¤ê¸° (Car Database ì˜ˆì œ)

## 1. Spring Boot í”„ë¡œì íŠ¸ ìƒì„±

[Spring Initializr](https://start.spring.io)ì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

* **í”„ë¡œì íŠ¸ ì„¤ì •**

  * Gradle - Groovy
  * Java
  * Spring Boot 3.5.6
  * Artifact : `com.example.cardatabase`
  * Packaging : Jar
  * Java : 17

* **ì¶”ê°€ Dependencies**

  * Spring Web
  * Spring Boot DevTools
  * Lombok
  * Spring Data JPA

---

## 2. Spring Bootì™€ JPA, Entity ê°œë…

* **Entity** : DBì˜ í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” í´ë˜ìŠ¤

  * í´ë˜ìŠ¤ = í…Œì´ë¸”
  * í•„ë“œ = ì»¬ëŸ¼
* JPAëŠ” Entityë¥¼ í†µí•´ DBì™€ ì—°ê²°ë˜ë©°, H2 ê°™ì€ in-memory DB í˜¹ì€ MariaDB ê°™ì€ ì™¸ë¶€ DBì™€ë„ ì‰½ê²Œ ì—°ë™ë©ë‹ˆë‹¤.
* EntityëŠ” ë°˜ë“œì‹œ **ê¸°ë³¸ ìƒì„±ì**ê°€ í•„ìš”í•©ë‹ˆë‹¤.
* `id` ê°’ì€ `@GeneratedValue(strategy = GenerationType.AUTO)`ë¡œ ì„¤ì •í•˜ì—¬ DBì—ì„œ ìë™ìœ¼ë¡œ ê³ ìœ  ê°’ì´ ìƒì„±ë©ë‹ˆë‹¤.

### Lombok ì ìš© ì „

```java
@Entity
public class Owner {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long ownerId;
    private String firstName, lastName;

    public Owner() {}
    public Owner(String firstName, String lastName) {
        this.firstName = firstName;
        this.lastName = lastName;
    }
    // getter / setter ì‘ì„±
}
```

### Lombok ì ìš© í›„

```java
@Entity
@Getter
@Setter
@ToString
@NoArgsConstructor(force = true)
@RequiredArgsConstructor
public class Owner {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long ownerId;

    private final String firstName;
    private final String lastName;
}
```

* `@NoArgsConstructor(force = true)` : `final` í•„ë“œê°€ ìˆì–´ë„ ê¸°ë³¸ ìƒì„±ìë¥¼ ê°•ì œë¡œ ìƒì„±
* `@RequiredArgsConstructor` : `final` í•„ë“œì— ëŒ€í•œ ìƒì„±ì ìë™ ìƒì„±

---

## 3. í…Œì´ë¸” ê°„ì˜ ê´€ê³„ (1\:N)

* **Owner (1) â†” Car (N)**
  í•œ ì†Œìœ ìëŠ” ì—¬ëŸ¬ ëŒ€ì˜ ìë™ì°¨ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŒ.

### Car.java

```java
@Entity
@Data
@NoArgsConstructor
public class Car {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;
    private String brand, model, color, registrationNumber;
    private int modelYear, price;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "owner")
    private Owner owner;
}
```

### Owner.java

```java
@Entity
@Getter
@Setter
@ToString
@NoArgsConstructor(force = true)
@RequiredArgsConstructor
public class Owner {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long ownerId;

    @NonNull
    private String firstName;
    @NonNull
    private String lastName;

    @OneToMany(cascade = CascadeType.ALL, mappedBy = "owner")
    private List<Car> cars;
}
```

* `@OneToMany(mappedBy = "owner")` : Car í…Œì´ë¸”ì˜ `owner` í•„ë“œì™€ ë§¤í•‘
* `cascade = CascadeType.ALL` : Owner ì‚­ì œ ì‹œ ê´€ë ¨ëœ Carë„ ê°™ì´ ì‚­ì œ
* `FetchType.LAZY` : í•„ìš”í•œ ì‹œì ì—ë§Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´

---

## 4. H2 â†’ MariaDB ì „í™˜

### build.gradle

```gradle
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    developmentOnly 'org.springframework.boot:spring-boot-devtools'
    // runtimeOnly 'com.h2database:h2'
    runtimeOnly 'org.mariadb.jdbc:mariadb-java-client'
}
```

### application.properties

```properties
spring.application.name=cardatabase
spring.datasource.url=jdbc:mariadb://localhost:3310/cardb
spring.datasource.username=root
spring.datasource.password=1234
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver

spring.jpa.generate-ddl=true
spring.jpa.hibernate.ddl-auto=create-drop
```

* **ddl-auto ì˜µì…˜**

  * `create-drop` : ì‹¤í–‰ ì‹œ ìƒì„±, ì¢…ë£Œ ì‹œ ì‚­ì œ (ê°œë°œ í™˜ê²½ ì í•©)
  * `update` : ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ ìë™ ë°˜ì˜
  * `none` : ì•„ë¬´ ì‘ì—… ì•ˆ í•¨

---

## 5. RESTful API ê¸°ë³¸

* REST = **Representational State Transfer**
* íŠ¹ì§•

  * ìƒíƒœ ë¹„ì €ì¥, í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ë…ë¦½, ìºì‹œ ê°€ëŠ¥, ì¼ê´€ëœ ì¸í„°í˜ì´ìŠ¤

### Controller ìƒì„±

```java
@RestController
public class CarController {
    private final CarRepository carRepository;
    public CarController(CarRepository carRepository) {
        this.carRepository = carRepository;
    }

    @GetMapping("/cars")
    public Iterable<Car> getCars(){
        return carRepository.findAll();
    }
}
```

---

## 6. JSON ì§ë ¬í™” ë¬¸ì œ í•´ê²°

ì—”í‹°í‹° ê°„ ì–‘ë°©í–¥ ì°¸ì¡° ì‹œ ë¬´í•œ ë°˜ë³µ ë°œìƒ â†’ `@JsonIgnoreProperties`, `@JsonIgnore`ë¡œ í•´ê²°

```java
@Entity
@JsonIgnoreProperties({"hibernateLazyInitializer", "handler"})
public class Owner {
    @JsonIgnore
    @OneToMany(cascade = CascadeType.ALL, mappedBy = "owner")
    private List<Car> cars;
}
```

---

## 7. Spring Data REST ì ìš©

* `CarRepository`, `OwnerRepository` ìë™ìœ¼ë¡œ REST API ìƒì„±
* ì—”ë“œí¬ì¸íŠ¸ : `/api/cars`, `/api/owners`

```java
@RepositoryRestResource(path="vehicles")
public interface CarRepository extends JpaRepository<Car, Long>{}
```

â†’ ì—”ë“œí¬ì¸íŠ¸ë¥¼ `/api/vehicles`ë¡œ ë³€ê²½ ê°€ëŠ¥

### HAL í¬ë§· ì‘ë‹µ ì˜ˆì‹œ

```json
{
  "_links": {
    "cars": {"href": "http://localhost:8080/api/cars{?page,size,sort}", "templated": true},
    "owners": {"href": "http://localhost:8080/api/owners{?page,size,sort}", "templated": true}
  }
}
```

---

## 8. Postman ì‹¤ìŠµ

* **GET** : `/api/cars` â†’ ì „ì²´ ëª©ë¡ ì¡°íšŒ
* **POST** : `/api/cars` â†’ ìƒˆ ìë™ì°¨ ì¶”ê°€
* **PATCH** : `/api/cars/6` â†’ ì¼ë¶€ ìˆ˜ì •
* **PUT** : `/api/cars/6` â†’ ì „ì²´ ìˆ˜ì •
* **DELETE** : `/api/cars/6` â†’ ì‚­ì œ

Owner ì—°ê²° ì‹œ `Content-Type: text/uri-list` ì§€ì • í›„ PUT ìš”ì²­

---

## 9. Query ë©”ì„œë“œ í™•ì¥

```java
@RepositoryRestResource
public interface CarRepository extends JpaRepository<Car, Long> {
    List<Car> findByBrand(@Param("brand") String brand);
    List<Car> findByColor(@Param("color") String color);
}
```

* `/api/cars/search/findByBrand?brand=Kia`
* `/api/cars/search/findByColor?color=White`

---

## ë§ˆë¬´ë¦¬

ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œ ë‹¤ë£¬ íë¦„

1. Spring Boot í”„ë¡œì íŠ¸ ìƒì„±
2. Entity ê°œë…ê³¼ Lombok ì ìš©
3. Owner â†” Car ê´€ê³„ ë§¤í•‘
4. H2 â†’ MariaDB ì´ì‹
5. REST API ë° ì§ë ¬í™” ë¬¸ì œ í•´ê²°
6. Spring Data REST ìë™ ì—”ë“œí¬ì¸íŠ¸
7. Postmanì„ í™œìš©í•œ CRUD í…ŒìŠ¤íŠ¸
8. Repositoryì— Query ë©”ì„œë“œ í™•ì¥
